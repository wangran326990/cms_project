package com.cms.core.dao;

import java.util.List;

import org.springframework.stereotype.Repository;

import com.cms.basic.dao.BaseDao;
import com.cms.basic.model.Pager;
import com.cms.core.model.Attachment;

@Repository("attachmentDao")
public class AttachmentDao extends BaseDao<Attachment> implements IAttachmentDao {

	private String getAttachmentSelect(){
		return "select new Attachment(a.id, a.newName, a.oldName, a.type, a.suffix, a.size, a.isIndexPic, a.isImg, a.isAttached, a.topic.id)";
	}
	
	@Override
	public Pager<Attachment> findNoUsedAttachment() {
		String hql = "select a from Attachment a"
				   + " where a.topic=null";
		return this.find(hql);
	}

	@Override
	public void clearNoUsedAttachment() {
		String hql ="delete from Attachment a "
				   + "where a.topic=null";
		this.updateByHql(hql);
	}

	@Override
	public void deleteByTopic(int tid) {
		String hql="delete from Attachment a "
				+ "where a.topic.id =?";
		this.updateByHql(hql, tid);
	}

	@Override
	public List<Attachment> listByTopic(int tid) {
		String hql=this.getAttachmentSelect()+" from Attachment a "
				+ "where a.topic.id =?";
		
		return this.list(hql, tid);
	}

	@Override
	public List<Attachment> listIndexPic(int nums) {
		String hql = this.getAttachmentSelect() + " from Attachment a "
												+ "where a.isIndexPic=1"
				
		return null;
	}

	@Override
	public Pager<Attachment> findChannelPic(int cid) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public List<Attachment> listAttachmentByTopic(int tid) {
		// TODO Auto-generated method stub
		return null;
	}

}
